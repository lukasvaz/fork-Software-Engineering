{% extends "base.html" %}
{% block title %}Ingresos y Egresos{% endblock %}


{% block content %}
    {% for transaction in transactions %}
        <tr >
            <th scope="row">{{transaction.set_at}}</th>
            <td>{{transaction.description}}</td>
            <td>{{transaction.income}}</td>
            <td>{{transaction.category}}</td>
            <td>{{transaction.tipo}}</td>
        </tr>
    {% endfor %}

    <script>
        const selectType = document.getElementById('transaction_type');
        selectType.addEventListener('change', updateTable);

        async function updateTable(e) {
        var selectedType = selectType.value;
        const xhttp = new XMLHttpRequest();
        var url = "{% url 'table' 0 %}".replace(/0/, selectedType.toString());
        
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                const response = this.response;
                var table=document.getElementById('home-table')
                table.innerHTML='';
                var json_response=JSON.parse(response)
                console.log(json_response);
                
                for(var i in json_response){
                    var transaction=json_response[i];
                    var row=document.createElement('tr');                
                    createColumn(row,transaction,'set_at','th')
                    createColumn(row,transaction,'descripcion','td')
                    createColumn(row,transaction,'monto','td')
                    createColumn(row,transaction,'categoria','td')
                    createColumn(row,transaction,'tipo','td')
                    table.appendChild(row);
                }
          }
        }
        xhttp.open("GET", url);
        xhttp.send();
    }

    function createColumn(row,transaction,atr,type){
            var column=document.createElement(type);
            column.innerText=transaction[atr];
            row.appendChild(column)
        }

</script>
    {% endblock content %}
    
    